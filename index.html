<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Local Weather & Holidays Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Instant local weather, forecast, air quality and upcoming holidays - one page.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- PWA manifest & theme color (added) -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2b6cb0">
  <link rel="icon" href="/icons/icon-192.svg" type="image/svg+xml">
<!-- optional PNG fallback -->
<link rel="icon" href="/icons/favicon-32.png" sizes="32x32" type="image/png">

</head>
<body>
  <div id="app" class="app">
    <header class="topbar">
      <div class="brand">
        <svg class="logo" viewBox="0 0 24 24" aria-hidden><path d="M12 2L3 7v7c0 5 4 9 9 9s9-4 9-9V7l-9-5z" fill="currentColor"/></svg>
        <div>
          <h1>Quick Local</h1>
          <p class="tag">Weather ‚Ä¢ Forecast ‚Ä¢ Air Quality ‚Ä¢ Holidays</p>
        </div>
      </div>

      <div class="controls">
  <div class="search-wrap">
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Search city or lat,lon..." 
      aria-label="Search location"
      class="search-input"
    />
    <button id="searchBtn" class="btn search-btn" title="Search location">üîç</button>
  </div>

  <div class="toggle-wrap" title="Toggle light / dark">
        <div class="toggle-wrap" title="Toggle light / dark">
          <label class="theme-toggle">
            <input id="themeToggle" type="checkbox" aria-label="Toggle theme">
            <span class="slider">
              <span class="emoji sun">‚òÄÔ∏è</span>
              <span class="emoji moon">üåô</span>
            </span>
          </label>
        </div>

        <button id="refreshBtn" class="btn action" title="Refresh data">‚ü≥ Refresh</button>
      </div>
    </header>

    <main class="main">
      <section class="grid">
        <!-- left: current -->
        <article class="card current" id="currentCard" aria-live="polite">
          <div class="current-top">
            <div class="temp-block">
              <div class="temp" id="temp">-¬∞C</div>
              <div class="desc" id="weatherDesc">Loading...</div>
              <div class="meta" id="locationName">Locating‚Ä¶</div>
            </div>

            <div class="weather-icon" id="currentIcon" aria-hidden>
              <!-- rendered by our JS -->
              <div class="icon-placeholder"></div>
            </div>
          </div>

          <div class="stats" role="status" aria-live="polite">
            <div class="stat"><div class="stat-value" id="wind">-</div><small>Wind</small></div>
            <div class="stat"><div class="stat-value" id="highLow">- / -</div><small>High / Low</small></div>
            <div class="stat"><div class="stat-value" id="precip">-</div><small>Precip (24h)</small></div>
          </div>

          <div class="alert-strip" id="alertStrip" hidden>
            <!-- generated alert notificaton-->
          </div>
        </article>

        <!-- right column: stacked compact -->
        <div class="right-col">
          <article class="card air" id="aqCard">
            <h3>Air Quality</h3>
            <div class="aq-row">
              <div class="aq-index" id="aqIndex">-</div>
              <div class="aq-info">
                <div id="aqLabel">Loading‚Ä¶</div>
                <small id="aqAdvice">-</small>
              </div>
            </div>
            <div class="aq-details" id="aqDetails" hidden>
              <small>pm2.5: <span id="pm25">-</span> ¬µg/m¬≥</small>
              <small>pm10: <span id="pm10">-</span> ¬µg/m¬≥</small>
            </div>
          </article>

          <article class="card forecast" id="forecastCard">
            <h3>7-Day Forecast</h3>
            <div class="forecast-list" id="forecastList" aria-live="polite">
              <!-- daily cards -->
            </div>
          </article>
        </div>

        <article class="card holidays" id="holidaysCard">
          <h3>Upcoming Holidays</h3>
          <div id="holidayList" class="holiday-list">Looking up holidays‚Ä¶</div>
        </article>
      </section>

      <!-- small status row with last-updated (added) -->
      <div id="statusRow" style="padding:10px 18px;font-size:13px;color:var(--muted);">
        <span id="lastUpdated">Last updated: -</span>
      </div>

      <footer class="foot">
        <small>Data sources: Open-Meteo, OpenStreetMap (Nominatim), Nager.Date - free public APIs.</small>
        <small>Context-driven alerts are heuristics, not official emergency warnings.</small>
      </footer>
    </main>
  </div>

  <!-- Offline banner (added) -->
  <div id="offlineBanner" style="position:fixed;left:12px;right:12px;bottom:14px;background:#2b6cb0;color:#fff;padding:10px 14px;border-radius:10px;display:none;z-index:9999;box-shadow:0 8px 24px rgba(0,0,0,0.12);font-size:13px;">
    <span id="offlineText">Offline - showing cached data</span>
    <span id="offlineLast" style="margin-left:10px;opacity:0.95;font-size:12px;">Last updated: -</span>
  </div>

  <script src="script.js" type="module"></script>

  <!-- Service Worker registration + bridge for showing the banner (added) -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('SW registered:', reg.scope))
        .catch(err => console.warn('SW register failed:', err));
    }

    // small bridge used by script.js to toggle the banner and update last-updated text
    window.__QL_PWA = {
      showOfflineBanner: (show, lastReadable) => {
        const b = document.getElementById('offlineBanner');
        const offlineLast = document.getElementById('offlineLast');
        if (!b) return;
        b.style.display = show ? 'block' : 'none';
        if (offlineLast && lastReadable) offlineLast.textContent = 'Last updated: ' + lastReadable;
      }
    };
  </script>
</body>
</html>
